<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>iframe tester</title>
    <link rel="stylesheet" href="https://public.codepenassets.com/css/reset-2.0.min.css">


  </head>
    
  <body>
  <!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>iframe tester</title>
    <link rel="stylesheet" href="https://public.codepenassets.com/css/reset-2.0.min.css">


  </head>
    
  <body>
  <!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Firza Radio Medan ‚Äî Vinyl Player (iTunes Sync)</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    font-family: "Segoe UI", Roboto, system-ui, -apple-system, "Helvetica Neue", Arial;
    display:flex;align-items:center;justify-content:center;
    background:linear-gradient(135deg,#667eea,#764ba2);
    transition:background 1s ease;
    min-height:100vh;
  }

  .card{
    width: 94%;
    max-width: 420px;
    background: rgba(255,255,255,0.08);
    backdrop-filter: blur(12px);
    border-radius: 20px;
    padding: 28px;
    text-align:center;
    box-shadow: 0 20px 50px rgba(0,0,0,0.45);
  }

  .title-app{
    color:#eaf2ff;
    font-weight:700;
    letter-spacing:1px;
    margin-bottom:14px;
    text-shadow:0 0 10px rgba(0,200,255,0.15);
  }

  .cover-wrap{ position:relative; width:200px; height:200px; margin: 0 auto 18px; }
  .neon-ring{
    position:absolute; inset:0; margin:auto;
    width:230px; height:230px; border-radius:50%;
    background: conic-gradient(from 0deg,#ff006e,#8338ec,#3a86ff,#06c,#ff006e);
    filter: blur(2px); opacity:.82;
    transform: translateZ(0);
    animation: ring-rot 3s linear infinite, ring-pulse 2.2s ease-in-out infinite;
  }
  @keyframes ring-rot{ from{transform:translateZ(0) rotate(0deg)} to{transform:translateZ(0) rotate(360deg)} }
  @keyframes ring-pulse{ 0%,100%{transform:scale(1)} 50%{transform:scale(1.04)} }

  .cover {
    position:absolute;
    top:50%; left:50%;
    transform: translate(-50%,-50%);
    width:200px; height:200px;
    border-radius:50%;
    object-fit:cover;
    box-shadow: 0 12px 30px rgba(0,0,0,0.5);
    animation: spin 10s linear infinite;
  }
  @keyframes spin{ from{transform:translate(-50%,-50%) rotate(0deg)} to{transform:translate(-50%,-50%) rotate(360deg)} }
  .cover.paused{ animation-play-state: paused; opacity:0.95 }

  .info { color:#f0f6ff; margin-bottom:8px }
  .song-title{ font-size:18px; font-weight:700; margin-bottom:4px; }
  .song-artist{ font-size:14px; color: #dbeafe; opacity:0.9; margin-bottom:6px; }
  .radio-name{ font-size:12px; color:#d1d5db; margin-bottom:8px; }

  .controls{ display:flex; justify-content:center; gap:18px; margin:12px 0; }
  .btn{
    width:62px; height:62px; border-radius:50%; border:none; cursor:pointer;
    background: rgba(255,255,255,0.14); color:white; font-size:20px;
    display:flex; align-items:center; justify-content:center;
    transition: transform .18s ease, box-shadow .18s ease, background .18s ease;
    box-shadow: 0 6px 18px rgba(0,0,0,0.35);
  }
  .btn:hover{ transform: translateY(-4px); background: rgba(255,255,255,0.22); box-shadow: 0 10px 26px rgba(0,0,0,0.45) }

  .play { width:86px; height:86px; font-size:26px; background: linear-gradient(135deg,#667eea,#764ba2) }

  .listeners{ font-size:13px; color:#e6eefc; opacity:0.9; margin-top:8px }

  /* responsive */
  @media (max-width:420px){
    .cover-wrap{ width:170px; height:170px }
    .neon-ring{ width:200px; height:200px }
    .cover{ width:170px; height:170px }
  }
</style>
</head>
<body>
  <div class="card" role="application" aria-label="Firza Radio Medan player">
    <div class="title-app">üéß Kiara IKIP Padang</div>

    <div class="cover-wrap" aria-hidden="false">
      <div class="neon-ring" id="neon"></div>
      <img id="cover" class="cover" src="http://cdn.theradiohub.com/logos/157.jpg" alt="Cover art" />
     </div>

    <div class="info" aria-live="polite">
      <div id="songTitle" class="song-title">Memuat...</div>
      <div id="songArtist" class="song-artist">Kiara IKIP Padang</div>
      <div class="radio-name">LIVE ‚Ä¢ Juneid Radio</div>
    </div>

    <div class="controls" role="toolbar" aria-label="Kontrol player">
      <button id="refreshBtn" class="btn" title="Refresh">üîÑ</button>
      <button id="playBtn" class="btn play" title="Play / Pause">‚ñ∂</button>
      <button id="stopBtn" class="btn" title="Stop">‚èπ</button>
    </div>

    <div class="listeners" id="listeners">Menunggu data‚Ä¶</div>
  </div>

  <audio id="audio" crossorigin="anonymous"></audio>

<script>
/* === Konfigurasi === */
const MOUNT_ID = "cn1fanz7hkeuv";                                 // id Zeno
const ZENO_NOWPLAYING = `https://zenoplay.zenomedia.com/api/zenofm/nowplaying/${MOUNT_ID}/?rand=`; 
const STREAM_URL = `https://stream.zeno.fm/${MOUNT_ID}`;
const FALLBACK_COVER = "http://cdn.theradiohub.com/logos/157.jpg";
const ITUNES_SEARCH = "https://itunes.apple.com/search?term=";     // no API key needed
const ITUNES_LIMIT = 1;

/* === Elemen UI === */
const audio = document.getElementById("audio");
const coverImg = document.getElementById("cover");
const songTitleEl = document.getElementById("songTitle");
const songArtistEl = document.getElementById("songArtist");
const listenersEl = document.getElementById("listeners");
const playBtn = document.getElementById("playBtn");
const stopBtn = document.getElementById("stopBtn");
const refreshBtn = document.getElementById("refreshBtn");

/* === State lokal === */
let isPlaying = false;
let lastNowPlayingSignature = "";   // supress duplicate cover lookups
let pendingLookup = null;           // to cancel/dedup quick successive updates

/* === Inisialisasi audio stream === */
audio.src = STREAM_URL;
audio.volume = 0.7;
audio.preload = "none"; // reduce initial bandwidth if desired

/* === Event tombol === */
playBtn.addEventListener("click", async () => {
  try {
    if (isPlaying) {
      audio.pause();
      playBtn.textContent = "‚ñ∂";
      coverImg.classList.add("paused");
    } else {
      await audio.play();
      playBtn.textContent = "‚è∏";
      coverImg.classList.remove("paused");
      listenersEl.textContent = "üéµ Terhubung";
    }
    isPlaying = !isPlaying;
  } catch (err) {
    console.error("Play error:", err);
    listenersEl.textContent = "‚ö†Ô∏è Tidak dapat memutar";
  }
});

stopBtn.addEventListener("click", () => {
  audio.pause();
  audio.currentTime = 0;
  isPlaying = false;
  playBtn.textContent = "‚ñ∂";
  coverImg.classList.add("paused");
  listenersEl.textContent = "‚èπ Dihentikan";
});

refreshBtn.addEventListener("click", fetchNowPlaying);

/* === Utility: delay + cancelable lookup === */
function debounceCancelable(fn, wait = 300) {
  let timer = null;
  return (...args) => {
    if (timer) clearTimeout(timer);
    return new Promise((resolve) => {
      timer = setTimeout(async () => {
        try {
          const r = await fn(...args);
          resolve(r);
        } catch (e) {
          resolve(null);
        }
      }, wait);
    });
  };
}

/* === Ambil nowplaying dari Zeno (robust) === */
async function fetchNowPlaying() {
  listenersEl.textContent = "üîÑ Memuat data...";
  try {
    const r = await fetch(ZENO_NOWPLAYING + Math.random(), { cache: "no-store" });
    if (!r.ok) throw new Error("Zeno API status " + r.status);
    const data = await r.json();
    handleNowPlayingData(data);
  } catch (err) {
    console.error("Nowplaying fetch failed:", err);
    listenersEl.textContent = "‚ö†Ô∏è Gagal ambil data";
    // jangan langsung fallback cover replace lagu; tunggu interval selanjutnya
  }
}

/* === Parsing dan sinkronisasi cover === */
function normalizeText(s) { return (s || "").trim(); }

/* Determine artist/title from Zeno's response:
   Many Zeno stations put "Artist - Title" inside `title` and leave artist empty.
   We attempt these fallbacks in order:
   1) If data.now_playing.song.* exists, use those fields.
   2) If data.title contains " - " then split.
   3) else use data.artist and data.title as given.
*/
function extractArtistTitle(data) {
  let title = "";
  let artist = "";

  // case: modern zeno payload may have nested now_playing
  if (data?.now_playing?.song) {
    const s = data.now_playing.song;
    title = normalizeText(s.title || s.track || s.song || data.title);
    artist = normalizeText(s.artist || s.performer || data.artist);
  }

  // fallback to top-level fields
  if (!title) title = normalizeText(data.title || "");
  if (!artist) artist = normalizeText(data.artist || "");

  // if title contains "Artist - Song" pattern, split
  if (title && !artist && title.includes(" - ")) {
    const parts = title.split(" - ");
    // Some streams use "Artist - Title"
    if (parts.length >= 2) {
      artist = normalizeText(parts[0]);
      title = normalizeText(parts.slice(1).join(" - "));
    }
  }

  // final safe defaults
  if (!title) title = "Firza Radio Medan";
  if (!artist) artist = "Firza Radio Medan";

  return { artist, title };
}

/* Debounced iTunes lookup to avoid spamming when title updates rapidly */
const lookupCoverDebounced = debounceCancelable(async (artist, title) => {
  try {
    const q = encodeURIComponent(`${artist} ${title}`);
    const url = `${ITUNES_SEARCH}${q}&limit=${ITUNES_LIMIT}&entity=song`;
    const r = await fetch(url);
    if (!r.ok) return null;
    const j = await r.json();
    if (j.results && j.results.length > 0) {
      // artworkUrl100 typical form; replace size with 600
      const art100 = j.results[0].artworkUrl100 || "";
      return art100.replace(/100x100bb.jpg|100x100bbpng|100x100bb\..*$/i, "600x600bb.jpg");
    }
    return null;
  } catch (e) {
    console.warn("iTunes lookup error", e);
    return null;
  }
}, 350);

/* Try to load image URL to ensure valid (CORS-safe). Returns true if loads within timeout. */
function testImage(url, timeout = 6000) {
  return new Promise((resolve) => {
    if (!url) return resolve(false);
    const img = new Image();
    let done = false;
    img.crossOrigin = "anonymous";
    img.onload = () => { if (!done) { done = true; resolve(true); } };
    img.onerror = () => { if (!done) { done = true; resolve(false); } };
    img.src = url;
    // timeout fallbacks
    setTimeout(() => { if (!done) { done = true; resolve(false); } }, timeout);
  });
}

/* Main handler: decides which cover to set */
async function handleNowPlayingData(data) {
  try {
    const { artist, title } = extractArtistTitle(data);
    const signature = `${artist}::${title}`;
    songTitleEl.textContent = title;
    songArtistEl.textContent = artist;

    // Update listeners UI if available
    if (data.listeners || data.current_listeners) {
      const cnt = data.listeners || data.current_listeners;
      listenersEl.textContent = `üéß ${cnt} pendengar ‚Ä¢ Live dari Medan`;
    } else {
      listenersEl.textContent = "üéµ Live dari Medan";
    }

    // If same (artist+title) as last time, do nothing (avoid re-lookup)
    if (signature === lastNowPlayingSignature) return;
    lastNowPlayingSignature = signature;

    // Cancel previous pending lookup (we use debounceCancelable so earlier pending will be cleared)
    pendingLookup = null;

    // 1) If Zeno provides a thumb / art URL, try it first
    const zenoThumbCandidates = [];
    if (data.thumb) zenoThumbCandidates.push(data.thumb);
    if (data.song_art_image_url) zenoThumbCandidates.push(data.song_art_image_url);
    if (data.image) zenoThumbCandidates.push(data.image);
    // nested
    if (data.now_playing && data.now_playing.song) {
      const s = data.now_playing.song;
      if (s.art) zenoThumbCandidates.push(s.art);
      if (s.image) zenoThumbCandidates.push(s.image);
    }

    // test zeno thumbs in order
    for (const url of zenoThumbCandidates) {
      if (url && typeof url === "string") {
        const ok = await testImage(url);
        if (ok) { coverImg.src = url; return; }
      }
    }

    // 2) Try iTunes lookup (debounced)
    listenersEl.textContent = "üîé Mencari cover di iTunes...";
    const itunesArt = await lookupCoverDebounced(artist, title);
    if (itunesArt) {
      const ok = await testImage(itunesArt);
      if (ok) { coverImg.src = itunesArt; listenersEl.textContent = "üéµ Live dari Medan"; return; }
    }

    // 3) As extra fallback, try small heuristics: try searching by title only
    if (artist && title && title.length > 3) {
      listenersEl.textContent = "üîé Coba pencarian alternatif...";
      const altItunes = await lookupCoverDebounced("", title);
      if (altItunes) {
        if (await testImage(altItunes)) { coverImg.src = altItunes; listenersEl.textContent = "üéµ Live dari Medan"; return; }
      }
    }

    // 4) Finally use fallback
    coverImg.src = FALLBACK_COVER;
    listenersEl.textContent = "üéµ Live dari Medan";
  } catch (err) {
    console.error("handleNowPlayingData error", err);
    coverImg.src = FALLBACK_COVER;
    listenersEl.textContent = "‚ö†Ô∏è Error menampilkan data";
  }
}

/* Periodic fetching + initial */
fetchNowPlaying();
setInterval(fetchNowPlaying, 30000); // update every 30s

/* Also cycle page background colors every 15s (visual) */
const BG_COLORS = [
  'linear-gradient(135deg,#667eea,#764ba2)',
  'linear-gradient(135deg,#f093fb,#f5576c)',
  'linear-gradient(135deg,#4facfe,#00f2fe)',
  'linear-gradient(135deg,#fa709a,#fee140)',
  'linear-gradient(135deg,#30cfd0,#330867)'
];
let bgIdx = 0;
setInterval(() => {
  bgIdx = (bgIdx + 1) % BG_COLORS.length;
  document.body.style.background = BG_COLORS[bgIdx];
}, 15000);

/* Accessibility: keyboard shortcuts (space = play/pause, r = refresh, s = stop) */
window.addEventListener("keydown", (e) => {
  if (e.key === " " || e.key === "Spacebar") {
    e.preventDefault(); playBtn.click();
  } else if (e.key.toLowerCase() === "r") refreshBtn.click();
  else if (e.key.toLowerCase() === "s") stopBtn.click();
});
</script>
</body>
</html>
    
  </body>
  
</html>
    
  </body>
  
</html>
